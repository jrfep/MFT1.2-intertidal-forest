---
title: "Plot Level 4 units based on marine provinces (MEOW) and mangrove biophysical type data"
---


We intersected the polygon of _Marine ecoregions_ or [MEOW](https://www.worldwildlife.org/publications/marine-ecoregions-of-the-world-a-bioregionalization-of-coastal-and-shelf-areas) with mangrove data from _Global Mangrove Watch_ for the year 2016 (GMW, http://data.unep-wcmc.org/datasets/45) and the _Global biophysical typology of mangroves_ for the year 2016 (https://data.unep-wcmc.org/datasets/48) and we plot the number of distinct groups of mangroves.


```{r}
require(spocc)
require(dplyr)
require(RPostgreSQL)
source(sprintf("%s/proyectos/IUCN-GET/MFT1.2-intertidal-forest/env/project-env.R",Sys.getenv("HOME")))
setwd(work.dir)

drv <- dbDriver("PostgreSQL") ## remember to update .pgpass file

con <- dbConnect(drv, dbname = Sys.getenv("DBNAME"),
              host = Sys.getenv("DBHOST"),
              port = Sys.getenv("DBPORT"),
              user = Sys.getenv("DBUSER"))

qry <- "SELECT taxonid,kingdom_name, phylum_name,   class_name, order_name, family_name, genus_name, scientific_name, taxonomic_authority, infra_rank, infra_name, population, category,  main_common_name, code,habitat, suitability, season, majorimportance FROM rlts_spp_taxonomy LEFT JOIN rlts_spp_habitats USING  (taxonid) where habitat like '%Mangr%'"

res <- dbGetQuery(con,qry)

head(res)
table(res$kingdom_name,res$habitat)

res %>% group_by(order_name) %>% summarise(total=n_distinct(scientific_name))

res %>% filter(family_name %in% "ZENARCHOPTERIDAE") %>% distinct(scientific_name) %>% pull -> spps
(occ_data <- occ(query = spps, from = 'gbif',limit=500))

res %>% distinct(family_name)

occ_data$gbif$data$Zenarchopterus_buffonis %>% select(longitude,latitude,countrycode,higherGeography)

dbDisconnect(con)
```
